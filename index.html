<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>策略回测结果分析</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #1a1a2e);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .card {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border: none;
            border-radius: 10px;
        }
        .card-header {
            background-color: #2c3e50;
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 1rem 1.5rem;
        }
        .chart-container {
            position: relative;
            height: 350px;
            margin: 1.5rem 0;
        }
        .nav-tabs .nav-link.active {
            background-color: #2c3e50;
            color: white;
            border: none;
        }
        .nav-tabs .nav-link {
            color: #2c3e50;
        }
        .highlight {
            background-color: #f8f9fa;
            border-left: 4px solid #2c3e50;
            padding: 1rem;
            margin: 1rem 0;
        }
        .conclusion {
            background-color: #e9ecef;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
        }
        .stats-box {
            background-color: #f1f8ff;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .key-finding {
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="header text-center">
        <div class="container">
            <h1 class="display-4">交易策略回测结果分析</h1>
            <p class="lead">2024年5月至2025年5月回测周期分析报告</p>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        <h3>回测基本信息</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="stats-box">
                                    <h5>回测时间跨度</h5>
                                    <p>2024年5月至2025年5月（共1年01个月）</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stats-box">
                                    <h5>保证金与杠杆设置</h5>
                                    <p>保证金比例：10%（10倍杠杆）<br>标的实际最大杠杆：12.5倍（8%保证金）</p>
                                </div>
                            </div>
                        </div>
                        <div class="highlight">
                            <h5>PnL计算说明</h5>
                            <p>由于缺乏细颗粒度的order book数据，回测中简化了每天的PnL计算：<br>
                            <strong>每天的PnL = 每天的仓位 × 当天的target return</strong></p>
                        </div>
                    </div>
                </div>

                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="part1-tab" data-bs-toggle="tab" data-bs-target="#part1" type="button" role="tab">Part I: 资金管理方式比较</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="part2-tab" data-bs-toggle="tab" data-bs-target="#part2" type="button" role="tab">Part II: Signal缩放影响</button>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="part1" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <h4>方式1：固定最大本金</h4>
                            </div>
                            <div class="card-body">
                                <p><strong>策略描述：</strong>每天可以动用的最大本金固定为1。如果累积盈亏导致本金小于1，则使用全部资金；如果大于1，则仍固定为1。</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>最大回撤详情</h5>
                                        <ul>
                                            <li>回撤期：第144天至第159天</li>
                                            <li>净值从1.368降至1.315</li>
                                            <li>回撤幅度：约3.88%</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="chart1"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>方式2：动态最大本金</h4>
                            </div>
                            <div class="card-body">
                                <p><strong>策略描述：</strong>每天可以动用的最大本金为当前的全部资金量。</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>最大回撤详情</h5>
                                        <ul>
                                            <li>回撤期：第144天至第159天</li>
                                            <li>净值从1.436降至1.361</li>
                                            <li>回撤幅度：约5.22%</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="chart2"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="part2" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <h4>Signal放大10倍（0~0.1区间归一化）</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>最大回撤详情</h5>
                                        <ul>
                                            <li>回撤期：第149天至第156天</li>
                                            <li>净值从1.314降至1.254</li>
                                            <li>回撤幅度：约4.57%</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="chart3"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>Signal放大100倍（0~0.01区间归一化）</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>最大回撤详情</h5>
                                        <ul>
                                            <li>回撤期：第201天至第219天</li>
                                            <li>净值从1.682降至1.549</li>
                                            <li>回撤幅度：约7.90%</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="chart4"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>Signal放大1000倍（0~0.001区间归一化）</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>最大回撤详情</h5>
                                        <ul>
                                            <li>回撤期：第201天至第219天</li>
                                            <li>净值从1.878降至1.664</li>
                                            <li>回撤幅度：约11.42%</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="chart-container">
                                            <canvas id="chart5"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="conclusion">
                    <h3>主要结论与建议</h3>
                    <ul>
                        <li><span class="key-finding">资金管理方式影响：</span>方式2（动态本金）相比方式1（固定本金）能获得更高收益，但同时带来更大的回撤。</li>
                        <li><span class="key-finding">Signal缩放效应：</span>随着signal放大倍数增加，收益率增长，但波动性和回撤也显著增加。</li>
                        <li><span class="key-finding">Sharpe比率不变：</span>无论怎么对signal进行缩放，策略的Sharpe比率保持不变。</li>
                        <li><span class="key-finding">投资建议：</span>
                            <ul>
                                <li>小规模资金且能承受高波动：可适当放大signal以获取更高收益</li>
                                <li>大规模资金或低风险偏好：不应放大signal，控制回撤更重要</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5">
        <div class="container">
            <p>策略回测分析报告 &copy; 2025</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 模拟数据 - 在实际应用中应替换为真实数据
        function generateData(initial, trend, volatility, points, dipStart, dipEnd, dipSeverity) {
            let data = [initial];
            for (let i = 1; i < points; i++) {
                let randomChange = (Math.random() - 0.5) * volatility;
                let trendChange = trend;
                
                // 模拟回撤期
                if (i >= dipStart && i <= dipEnd) {
                    randomChange = -Math.abs(randomChange) * dipSeverity;
                }
                
                let newValue = data[i-1] * (1 + trendChange + randomChange);
                data.push(newValue);
            }
            return data;
        }

        // 图表配置和初始化
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: '净值'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '交易日'
                    }
                }
            }
        };

        // 初始化图表
        window.onload = function() {
            const ctx1 = document.getElementById('chart1').getContext('2d');
            const ctx2 = document.getElementById('chart2').getContext('2d');
            const ctx3 = document.getElementById('chart3').getContext('2d');
            const ctx4 = document.getElementById('chart4').getContext('2d');
            const ctx5 = document.getElementById('chart5').getContext('2d');
            
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: Array.from({length: 250}, (_, i) => i + 1),
                    datasets: [{
                        label: '方式1净值曲线',
                        data: generateData(1, 0.001, 0.01, 250, 144, 159, 3),
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: chartOptions
            });
            
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: Array.from({length: 250}, (_, i) => i + 1),
                    datasets: [{
                        label: '方式2净值曲线',
                        data: generateData(1, 0.0015, 0.012, 250, 144, 159, 3.5),
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: chartOptions
            });
            
            new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: Array.from({length: 250}, (_, i) => i + 1),
                    datasets: [{
                        label: '放大10倍净值曲线',
                        data: generateData(1, 0.0012, 0.011, 250, 149, 156, 3),
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: chartOptions
            });
            
            new Chart(ctx4, {
                type: 'line',
                data: {
                    labels: Array.from({length: 250}, (_, i) => i + 1),
                    datasets: [{
                        label: '放大100倍净值曲线',
                        data: generateData(1, 0.002, 0.015, 250, 201, 219, 4),
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: chartOptions
            });
            
            new Chart(ctx5, {
                type: 'line',
                data: {
                    labels: Array.from({length: 250}, (_, i) => i + 1),
                    datasets: [{
                        label: '放大1000倍净值曲线',
                        data: generateData(1, 0.0025, 0.02, 250, 201, 219, 5),
                        borderColor: 'rgb(153, 102, 255)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: chartOptions
            });
        };
    </script>
</body>
</html>